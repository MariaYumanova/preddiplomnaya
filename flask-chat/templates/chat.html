<div id="flask-chat">
    <div id="chat-messages"></div>
    <input type="text" id="message-input" placeholder="Ваше сообщение...">
    <button id="send-btn">Отправить</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.4.1/socket.io.min.js"></script>
<script>
    const socket = io('http://localhost:5000', {
        transports: ['websocket'],
        reconnection: true
    });

    socket.on('connect', () => {
        console.log('✅ Подключено к чату');
    });

    socket.on('message_history', (data) => {
        const chat = document.getElementById('chat-messages');
        data.messages.forEach(msg => {
            chat.innerHTML += `<div class="msg">${msg}</div>`;
        });
    });

    socket.on('message_update', (data) => {
        const chat = document.getElementById('chat-messages');
        chat.innerHTML += `<div class="msg">${data}</div>`;
        chat.scrollTop = chat.scrollHeight;
    });

    document.getElementById('send-btn').addEventListener('click', sendMessage);
    document.getElementById('message-input').addEventListener('keypress', (e) => {
        if(e.key === 'Enter') sendMessage();
    });

    function sendMessage() {
        const input = document.getElementById('message-input');
        const message = input.value.trim();
        if(message) {
            socket.emit('new_message', message);
            input.value = '';
        }
    }
</script>